generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum BILLING_CYCLE {
  MONTHLY
  YEARLY
}

enum PLAN_TYPE {
  PRO
}

enum CREDIT_TRACKING_TYPE {
  CONSUME
  RENEW_SUBSCRIPTION
  GRANT
  INITIAL_SUBSCRIPTION
}

enum SUBSCRIPTION_STATUS {
  ACTIVE
  CANCELLED
}

enum CREDIT_SYSTEM_TYPE {
  AI_BLOG_GEN
  BLOG_SUMMARY
  TEXT_TRANSLATION
  TEXT_REWRITE    
  GRAMMAR_CHECK
  IMAGE_STORAGE
}

enum USER_ROLE {
  CUSTOMER
  ADMIN
}
enum WEBHOOK_STATUS {
  FAILED
  SUCCESS
}
enum CUSTOMER_PORTAL_TYPE{
  CANCEL_SUBSCRIPTION
  INVOICE_HISTORY
  PAYMENT_METHODS
}
enum CREDIT_TRACKING_STATUS{
  PENDING
  COMPLETED
  FAILED
}

model User {
  id                 String         @id @default(ulid())
  stripeCustomerId   String?
  firstName          String
  lastName           String
  password           String
  email              String         
  salt               String
  role               USER_ROLE      @default(CUSTOMER)
  isActive           Boolean        @default(true)
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
  deletedAt          DateTime?
}

model AuthSession {
  id          String   @id @default(ulid())
  userId      String
  roleAtLogin USER_ROLE
  expiresAt   DateTime
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  deletedAt   DateTime?
}
model Blog {
  id        String   @id @default(ulid())
  title     String
  content   String
  authorId  String
  isActive           Boolean @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model Plan {
  id                 String         @id @default(ulid())
  name               String
  description        String?
  price              Float
  durationDays       Int
  stripeProductId    String
  stripePriceId      String
  isDisplay          Boolean
  isTrial            Boolean
  trialDays          Int?
  creditLimits       Int
  billingCycle       BILLING_CYCLE
  planType           PLAN_TYPE
  isActive           Boolean        @default(true)
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
  deletedAt          DateTime?
}

model Subscription {
  id                   String         @id @default(ulid())
  userId               String
  planId               String
  stripeSubscriptionId String
  stripeSiId           String
  status               SUBSCRIPTION_STATUS
  createdAt            DateTime       @default(now())
  updatedAt            DateTime       @updatedAt
  deletedAt            DateTime?
}

model CreditSystem {
  id           String            @id @default(ulid())
  name         String
  type         CREDIT_SYSTEM_TYPE
  description  String?
  amount       Float
  isActive     Boolean        @default(true)
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  deletedAt    DateTime?
}

model CreditTracking {
  id               String           @id @default(ulid())
  userId           String
  currency         String
  creditSystemType CREDIT_SYSTEM_TYPE?
  amount           Float
  type             CREDIT_TRACKING_TYPE
  status            CREDIT_TRACKING_STATUS
  subscriptionId      String?
  isActive           Boolean        @default(true)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  deletedAt        DateTime?
}

model WebhookLog {
  id          String   @id @default(ulid())
  event       String
  payload     Json
  status      WEBHOOK_STATUS
  receivedAt  DateTime
  isActive           Boolean        @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  deletedAt   DateTime?
}
